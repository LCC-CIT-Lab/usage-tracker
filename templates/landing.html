<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Landing Page</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"> 
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            {% for message in lab_location.messages %}
                <div class="message">
                    <p>{{ message.content }}</p>
                    <small>Posted by {{ message.user.name }} on {{ message.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</small>
                </div>
            {% endfor %}
            <br><br>
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    <div class="alert">
                        {{ messages[0] }}
                    </div>
                {% endif %}
            {% endwith %}

            <div class="dashboard-header"><h3>Lab Sign-In</h3></div>

            <form method="post" action="{{ url_for('main.landing') }}">
                {{ form.hidden_tag() }}
                <div>
                    {{ form.l_number.label }}<br>
                    L-{{ form.l_number(size=32) }}
                    {% if form.l_number.errors %}
                        <div class="error">{{ form.l_number.errors[0] }}</div>
                    {% endif %}
                </div>
                <br>
                <div>
                    <input type="submit" value="Submit">
                </div>
            </form>
            <br>
            <span id="sign-in-count" data-lab-id="{{ lab_id }}">Loading...</span>
            <script>
                $(document).ready(function() {
                    function updateSignedInCount() {
                        var labId = $('#sign-in-count').data('labId'); // Correct the case to match the data attribute
                        if (labId) {  // Check if labId is not null or undefined
                            $.ajax({
                                url: '/current_sign_ins/' + labId,
                                type: 'GET',
                                dataType: 'json',
                                success: function(response) {
                                    $('#sign-in-count').text(response.count + ' users signed in');
                                },
                                error: function() {
                                    $('#sign-in-count').text('0 users signed in');
                                }
                            });
                        } else {
                            console.error('Invalid lab ID');
                            $('#sign-in-count').text('Invalid lab ID');
                        }
                    }
                    setInterval(updateSignedInCount, 1000);
                });

            </script>
        </div>
    </div>

</body>
</html>
