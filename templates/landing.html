<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Landing Page</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"> 
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">

            {% if lab_location %}
                {% if messages %}
                    {% for message in messages %}
                        <div class="lab-message">
                            {{ message.content|safe }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endif %}

            <br><br>

            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    <div class="alert">
                        {{ messages[0] }}
                    </div>
                {% endif %}
            {% endwith %}

            <br><br><br><br>
            <div class="dashboard-header-signin"><h3>{{ lab_location_name }} <br> Sign In  / Sign Out</h3></div>

            <form method="post" action="{{ url_for('main.landing') }}">
                {{ form.hidden_tag() }}
                <div>
                    <h3>
                        <br>
                        L - {{ form.l_number(size=7, placeholder="00000000", autofocus=true) }}
                        {% if form.l_number.errors %}
                            <div class="error">{{ form.l_number.errors[0] }}</div>
                        {% endif %}
                    </h3>
                </div>
                <br>
                <div>
                    <input type="submit" value="Submit">
                </div>
            </form>
            <br><br>
            <span id="sign-in-count" data-lab-id="{{ lab_id }}">Loading...</span>
            <script>
                $(document).ready(function() {
                    function updateSignedInCount() {
                        var labId = $('#sign-in-count').data('lab-id'); // Correct the case to match the data attribute
                        if (labId && labId !== 'None') {  // Check if labId is not null, undefined, or 'None'
                            $.ajax({
                                url: '/current_sign_ins/' + labId,
                                type: 'GET',
                                dataType: 'json',
                                success: function(response) {
                                    $('#sign-in-count').text(response.count + ' users signed in');
                                },
                                error: function() {
                                    $('#sign-in-count').text('Error getting users');
                                }
                            });
                        } else {
                            console.error('Invalid lab ID');
                            $('#sign-in-count').text('Invalid lab ID');
                        }
                    }
                    setInterval(updateSignedInCount, 2000);
                });

            </script>
        </div>
    </div>

</body>
</html>
